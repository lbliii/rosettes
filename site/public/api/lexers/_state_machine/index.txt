# _state_machine

URL: /api/lexers/_state_machine/
Section: lexers

--------------------------------------------------------------------------------

_state_machine - Rosettes window.BENGAL_THEME_DEFAULTS = { appearance: 'system', palette: '' }; window.Bengal = window.Bengal || {}; window.Bengal.enhanceBaseUrl = '/assets/js/enhancements'; window.Bengal.watchDom = true; window.Bengal.debug = false; window.Bengal.enhanceUrls = { 'toc': '/assets/js/enhancements/toc.js', 'docs-nav': '/assets/js/enhancements/docs-nav.js', 'tabs': '/assets/js/enhancements/tabs.js', 'lightbox': '/assets/js/enhancements/lightbox.js', 'interactive': '/assets/js/enhancements/interactive.js', 'mobile-nav': '/assets/js/enhancements/mobile-nav.js', 'action-bar': '/assets/js/enhancements/action-bar.js', 'copy-link': '/assets/js/enhancements/copy-link.js', 'data-table': '/assets/js/enhancements/data-table.js', 'lazy-loaders': '/assets/js/enhancements/lazy-loaders.js', 'holo': '/assets/js/enhancements/holo.js', 'link-previews': '/assets/js/enhancements/link-previews.js' }; (function () { try { var defaults = window.BENGAL_THEME_DEFAULTS || { appearance: 'system', palette: '' }; var defaultAppearance = defaults.appearance; if (defaultAppearance === 'system') { defaultAppearance = (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) ? 'dark' : 'light'; } var storedTheme = localStorage.getItem('bengal-theme'); var storedPalette = localStorage.getItem('bengal-palette'); var theme = storedTheme ? (storedTheme === 'system' ? defaultAppearance : storedTheme) : defaultAppearance; var palette = storedPalette ?? defaults.palette; document.documentElement.setAttribute('data-theme', theme); if (palette) { document.documentElement.setAttribute('data-palette', palette); } } catch (e) { document.documentElement.setAttribute('data-theme', 'light'); } })(); { "prerender": [ { "where": { "and": [ { "href_matches": "/docs/*" }, { "not": { "selector_matches": "[data-external], [target=_blank], .external" } } ] }, "eagerness": "conservative" } ], "prefetch": [ { "where": { "and": [ { "href_matches": "/*" }, { "not": { "selector_matches": "[data-external], [target=_blank], .external" } } ] }, "eagerness": "conservative" } ] } Skip to main content ❀ DocumentationArrow ClockwiseGet StartedCodeHighlightingPaletteStylingStarburstExtendingNoteTutorialsBookmarkReferenceInfoAboutReleasesDevGitHubAPI Reference Palette Appearance Chevron Down Mode Monitor System Sun Light Moon Dark Palette Snow Lynx Brown Bengal Silver Bengal Charcoal Bengal Blue Bengal List ❀ X Close Documentation Caret Down Arrow Clockwise Get Started Code Highlighting Palette Styling Starburst Extending Note Tutorials Bookmark Reference Info About Releases Dev Caret Down GitHub API Reference Palette Appearance Chevron Down Mode Monitor System Sun Light Moon Dark Palette Snow Lynx Brown Bengal Silver Bengal Charcoal Bengal Blue Bengal Rosettes API Reference Caret Right Formatters html Caret Right Lexers _scanners _state_machine bash_sm c_sm clojure_sm cpp_sm css_sm csv_sm cuda_sm cue_sm dart_sm diff_sm dockerfile_sm elixir_sm gleam_sm go_sm graphql_sm groovy_sm haskell_sm hcl_sm html_sm ini_sm java_sm javascript_sm jinja_sm json_sm julia_sm kida_sm kotlin_sm lua_sm makefile_sm markdown_sm mojo_sm nginx_sm nim_sm perl_sm php_sm pkl_sm plaintext_sm powershell_sm protobuf_sm python_sm r_sm ruby_sm rust_sm scala_sm sql_sm stan_sm swift_sm toml_sm tree_sm triton_sm typescript_sm v_sm xml_sm yaml_sm zig_sm Caret Right Themes _mapping _palette _roles palettes _config _escape _parallel _protocol _registry _types delegate rosettes Rosettes API ReferenceLexers ᗢ Caret Down Link Copy URL External Open LLM text Copy Copy LLM text Share with AI Ask Claude Ask ChatGPT Ask Gemini Ask Copilot Module lexers._state_machine Base class for hand-written state machine lexers. Thread-safe, O(n) guaranteed, zero regex. File Code View source 1Class6Functions Classes StateMachineLexer 14 ▼ Base class for hand-written state machine lexers. Thread-safe: tokenize() uses only local variable… Base class for hand-written state machine lexers. Thread-safe: tokenize() uses only local variables. O(n) guaranteed: single pass, no backtracking. Subclasses implement language-specific tokenization by overriding the tokenize() method with character-by-character logic. Design Principles: 1. No regex — character matching only 2. Explicit state — no hidden backtracking 3. Local variables only — thread-safe by design 4. Single pass — O(n) guaranteed Attributes Name Type Description name str — aliases tuple[str, ...] — filenames tuple[str, ...] — mimetypes tuple[str, ...] — DIGITS frozenset[str] — HEX_DIGITS frozenset[str] — OCTAL_DIGITS frozenset[str] — BINARY_DIGITS frozenset[str] — LETTERS frozenset[str] — IDENT_START frozenset[str] — IDENT_CONT frozenset[str] — WHITESPACE frozenset[str] — Methods Functions scan_while 3 int ▼ Advance position while characters are in char_set. def scan_while(code: str, pos: int, char_set: frozenset[str]) -&gt; int Parameters Name Type Description code str Source code string. pos int Starting position. char_set frozenset[str] Set of characters to match. Returns int scan_until 3 int ▼ Advance position until a character in char_set is found. def scan_until(code: str, pos: int, char_set: frozenset[str]) -&gt; int Parameters Name Type Description code str Source code string. pos int Starting position. char_set frozenset[str] Set of characters to stop at. Returns int scan_string 3 int ▼ Scan a string literal, handling escapes. def scan_string(code: str, pos: int, quote: str) -&gt; int Parameters Name Type Description code str Source code. pos int Position after opening quote. quote str The quote character (' or &quot;). Returns int scan_triple_string 3 int ▼ Scan a triple-quoted string. def scan_triple_string(code: str, pos: int, quote: str) -&gt; int Parameters Name Type Description code str Source code. pos int Position after opening triple quote. quote str The quote character (' or &quot;). Returns int scan_line_comment 2 int ▼ Scan to end of line (for line comments). def scan_line_comment(code: str, pos: int) -&gt; int Parameters Name Type Description code str Source code. pos int Starting position (after comment marker). Returns int scan_block_comment 3 int ▼ Scan a block comment until end marker. def scan_block_comment(code: str, pos: int, end_marker: str) -&gt; int Parameters Name Type Description code str Source code. pos int Position after opening marker. end_marker str The closing marker (e.g., &quot;*/&quot; or &quot;--&gt;&quot;). Returns int ← Previous _scanners Next → bash_sm List &copy; 2026 Rosettes ᓚᘏᗢ window.BENGAL_LAZY_ASSETS = { tabulator: '/assets/js/tabulator.min.js', dataTable: '/assets/js/data-table.js', mermaidToolbar: '/assets/js/mermaid-toolbar.js', mermaidTheme: '/assets/js/mermaid-theme.js', graphMinimap: '/assets/js/graph-minimap.js', graphContextual: '/assets/js/graph-contextual.js' }; window.BENGAL_ICONS = { close: '/assets/icons/close.svg', enlarge: '/assets/icons/enlarge.svg', copy: '/assets/icons/copy.svg', 'download-svg': '/assets/icons/download.svg', 'download-png': '/assets/icons/image.svg', 'zoom-in': '/assets/icons/zoom-in.svg', 'zoom-out': '/assets/icons/zoom-out.svg', reset: '/assets/icons/reset.svg' }; Arrow Up

--------------------------------------------------------------------------------

Metadata:
- Word Count: 824
- Reading Time: 4 minutes