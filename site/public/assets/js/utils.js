(function(){'use strict';const DEBUG=(window.Bengal&&window.Bengal.debug)||false;function log(...args){if(DEBUG){console.log('[Bengal]',...args);}}
async function copyToClipboard(text){if(navigator.clipboard&&navigator.clipboard.writeText){try{await navigator.clipboard.writeText(text);return;}catch(err){log('Clipboard API failed, using fallback:',err);}}
const textarea=document.createElement('textarea');textarea.value=text;textarea.style.position='fixed';textarea.style.top='0';textarea.style.left='0';textarea.style.opacity='0';textarea.style.pointerEvents='none';document.body.appendChild(textarea);try{textarea.select();textarea.setSelectionRange(0,text.length);const successful=document.execCommand('copy');if(!successful){throw new Error('execCommand copy failed');}}finally{document.body.removeChild(textarea);}}
function throttleScroll(callback){let ticking=false;return function throttled(...args){const context=this;if(!ticking){window.requestAnimationFrame(()=>{callback.apply(context,args);ticking=false;});ticking=true;}};}
function debounce(func,wait){let timeout;return function executedFunction(...args){const context=this;const later=()=>{clearTimeout(timeout);func.apply(context,args);};clearTimeout(timeout);timeout=setTimeout(later,wait);};}
function ready(callback){if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',callback,{once:true});}else{callback();}}
function isExternalUrl(href){if(!href||href.startsWith('#')||href.startsWith('mailto:')||href.startsWith('tel:')){return false;}
if(href.startsWith('/')||href.startsWith('./')||href.startsWith('../')){return false;}
try{const url=new URL(href,window.location.href);const currentOrigin=window.location.origin;return url.origin!==currentOrigin;}catch(e){return false;}}
function escapeRegex(str){return str.replace(/[.*+?^${}()|[\]\\]/g,'\\$&');}
const scrollManager={listeners:new Set(),handler:null,add(callback){this.listeners.add(callback);if(this.listeners.size===1){this.handler=throttleScroll(()=>{this.listeners.forEach(cb=>{try{cb();}catch(err){log('Scroll listener error:',err);}});});window.addEventListener('scroll',this.handler,{passive:true});}},remove(callback){this.listeners.delete(callback);if(this.listeners.size===0&&this.handler){window.removeEventListener('scroll',this.handler);this.handler=null;}}};function createFocusTrap(container){const FOCUSABLE='a[href], button:not([disabled]), textarea, input, select, [tabindex]:not([tabindex="-1"])';return function handleKeydown(e){if(e.key!=='Tab')return;const focusables=Array.from(container.querySelectorAll(FOCUSABLE));if(focusables.length===0)return;const first=focusables[0];const last=focusables[focusables.length-1];const active=document.activeElement;if(e.shiftKey){if(active===first||!container.contains(active)){e.preventDefault();last.focus();}}else{if(active===last){e.preventDefault();first.focus();}}};}
async function loadIcon(iconName){if(!window.BENGAL_ICONS||!window.BENGAL_ICONS[iconName]){log('Icon not found:',iconName);return'';}
const iconPath=window.BENGAL_ICONS[iconName];try{const response=await fetch(iconPath);if(!response.ok){log('Failed to load icon:',iconName,response.status);return'';}
const svgText=await response.text();return svgText.replace(/fill="(?!(?:none|transparent))[^"]*"/g,'fill="currentColor"').replace(/stroke="(?!(?:none|transparent))[^"]*"/g,'stroke="currentColor"');}catch(err){log('Error loading icon:',iconName,err);return'';}}
window.BengalUtils={log,copyToClipboard,throttleScroll,debounce,ready,isExternalUrl,escapeRegex,scrollManager,createFocusTrap,loadIcon};log('Utilities initialized');})();