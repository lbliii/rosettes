(function(){'use strict';if(!window.BengalUtils){console.error('BengalUtils not loaded - copy-link.js requires utils.js');return;}
const{log,copyToClipboard,ready}=window.BengalUtils;function setupCopyLinkButtons(){const headings=document.querySelectorAll('h2[id], h3[id], h4[id], h5[id], h6[id]');if(headings.length===0)return;headings.forEach(heading=>{if(heading.querySelector('.copy-link'))return;if(!heading.classList.contains('heading-anchor')){heading.classList.add('heading-anchor');}
const id=heading.getAttribute('id');const link=document.createElement('a');link.href=`#${id}`;link.className='copy-link';link.setAttribute('aria-label','Copy link to this section');link.setAttribute('title','Copy link');link.innerHTML=`<svg viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"stroke-linecap="round"stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`;link.addEventListener('click',function(e){if(!e.ctrlKey&&!e.metaKey&&!e.shiftKey&&e.button===0){e.preventDefault();const url=`${window.location.origin}${window.location.pathname}#${id}`;copyToClipboard(url).then(()=>{showCopySuccess(link);}).catch((err)=>{log('Failed to copy link:',err);showCopyError(link);});}
});heading.appendChild(link);});}
function showCopySuccess(button){button.innerHTML=`<svg viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"stroke-linecap="round"stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;button.classList.add('copied');button.setAttribute('aria-label','Link copied!');setTimeout(()=>{button.innerHTML=`<svg viewBox="0 0 24 24"fill="none"stroke="currentColor"stroke-width="2"stroke-linecap="round"stroke-linejoin="round"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg>`;button.classList.remove('copied');button.setAttribute('aria-label','Copy link to this section');button.blur();},2000);}
function showCopyError(button){button.setAttribute('aria-label','Failed to copy');setTimeout(()=>{button.setAttribute('aria-label','Copy link to this section');},2000);}
function init(){setupCopyLinkButtons();log('Copy link anchors initialized');}
ready(init);})();