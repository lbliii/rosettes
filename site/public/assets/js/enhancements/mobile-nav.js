(function(){'use strict';const log=window.BengalUtils?.log||(()=>{});function toggleSubmenu(listItem,forceOpen){const isOpen=listItem.classList.contains('submenu-open');const shouldOpen=forceOpen!==undefined?forceOpen:!isOpen;const toggleBtn=listItem.querySelector('.mobile-nav-toggle-submenu');if(shouldOpen){listItem.classList.add('submenu-open');if(toggleBtn)toggleBtn.setAttribute('aria-expanded','true');}else{listItem.classList.remove('submenu-open');if(toggleBtn)toggleBtn.setAttribute('aria-expanded','false');}}
function autoExpandActiveSections(dialog){const activeItems=dialog.querySelectorAll('.mobile-nav-content li.active, .mobile-nav-content li.active-trail');activeItems.forEach(function(item){let parent=item.parentElement;while(parent){if(parent.classList&&parent.classList.contains('has-submenu')){toggleSubmenu(parent,true);}
parent=parent.parentElement;}
if(item.classList.contains('has-submenu')&&item.classList.contains('active-trail')){toggleSubmenu(item,true);}});}
function init(){const dialog=document.getElementById('mobile-nav-dialog');if(!dialog){log('[BengalNav] Mobile nav dialog not found');return;}
log('[BengalNav] Initialized dialog-based mobile navigation');const navLinks=dialog.querySelectorAll('.mobile-nav-content a:not(.mobile-nav-toggle-submenu)');navLinks.forEach(function(link){link.addEventListener('click',function(){setTimeout(function(){dialog.close();},150);});});const toggleButtons=dialog.querySelectorAll('.mobile-nav-toggle-submenu');toggleButtons.forEach(function(btn){btn.addEventListener('click',function(e){e.preventDefault();e.stopPropagation();const listItem=btn.closest('li.has-submenu');if(listItem){toggleSubmenu(listItem);}});});const dropdownTriggers=dialog.querySelectorAll('.mobile-nav-content .nav-dropdown-trigger');dropdownTriggers.forEach(function(trigger){trigger.addEventListener('click',function(e){e.preventDefault();const listItem=trigger.closest('li.has-submenu');if(listItem){toggleSubmenu(listItem);}});trigger.addEventListener('keydown',function(e){if(e.key==='Enter'||e.key===' '){e.preventDefault();const listItem=trigger.closest('li.has-submenu');if(listItem){toggleSubmenu(listItem);}}});});dialog.addEventListener('open',function(){autoExpandActiveSections(dialog);});const originalShowModal=dialog.showModal.bind(dialog);dialog.showModal=function(){originalShowModal();autoExpandActiveSections(dialog);};const searchBtn=dialog.querySelector('.mobile-nav-search');if(searchBtn){searchBtn.addEventListener('click',function(){dialog.close();setTimeout(function(){if(window.BengalSearchModal&&typeof window.BengalSearchModal.open==='function'){window.BengalSearchModal.open();}},100);});}
dialog.addEventListener('click',function(e){if(e.target===dialog){dialog.close();}});}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}
window.BengalNav={open:function(){const dialog=document.getElementById('mobile-nav-dialog');if(dialog)dialog.showModal();},close:function(){const dialog=document.getElementById('mobile-nav-dialog');if(dialog)dialog.close();},toggle:function(){const dialog=document.getElementById('mobile-nav-dialog');if(dialog){if(dialog.open)dialog.close();else dialog.showModal();}}};if(window.Bengal&&window.Bengal.enhance){Bengal.enhance.register('mobile-nav',function(el,options){el._bengalNav=window.BengalNav;},{override:true});}})();