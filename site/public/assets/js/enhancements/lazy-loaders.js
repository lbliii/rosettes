(function(){'use strict';const assets=window.BENGAL_LAZY_ASSETS||{};const loaded={mermaid:false,d3:false,tabulator:false};const pending={mermaid:false,d3:false};function loadScript(src,onload,options={}){const script=document.createElement('script');script.src=src;if(options.async!==false)script.async=true;if(onload)script.onload=onload;script.onerror=()=>{console.warn('[Bengal] Failed to load script:',src);};document.head.appendChild(script);}
function preloadScript(src){if(!src)return;const link=document.createElement('link');link.rel='preload';link.as='script';link.href=src;document.head.appendChild(link);}
function loadTabulator(){if(loaded.tabulator)return;if(!document.querySelector('.bengal-data-table-wrapper'))return;if(!assets.tabulator)return;loaded.tabulator=true;loadScript(assets.tabulator,function(){if(assets.dataTable)loadScript(assets.dataTable);});}
function initMermaid(){if(typeof mermaid!=='undefined'){if(assets.mermaidToolbar){loadScript(assets.mermaidToolbar,function(){if(assets.mermaidTheme)loadScript(assets.mermaidTheme);});}}}
function loadMermaid(){if(loaded.mermaid||pending.mermaid)return;pending.mermaid=true;loaded.mermaid=true;loadScript('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js',initMermaid);}
function initD3Graphs(){window.dispatchEvent(new Event('d3:ready'));if(assets.graphMinimap)loadScript(assets.graphMinimap);if(assets.graphContextual)loadScript(assets.graphContextual);}
function loadD3(){if(loaded.d3||pending.d3)return;pending.d3=true;loaded.d3=true;loadScript('https://d3js.org/d3.v7.min.js',initD3Graphs);}
function setupIntersectionObserver(){if(!('IntersectionObserver'in window)){if(document.querySelector('.mermaid'))loadMermaid();if(document.querySelector('.graph-minimap, .graph-contextual, [data-graph]'))loadD3();return;}
const observer=new IntersectionObserver((entries)=>{entries.forEach((entry)=>{if(!entry.isIntersecting)return;const el=entry.target;if(el.classList.contains('mermaid')){loadMermaid();}else if(el.classList.contains('graph-minimap')||el.classList.contains('graph-contextual')||el.hasAttribute('data-graph')){loadD3();}
observer.unobserve(el);});},{rootMargin:'200px 0px',threshold:0});document.querySelectorAll('.mermaid').forEach((el)=>{observer.observe(el);});document.querySelectorAll('.graph-minimap, .graph-contextual, [data-graph]').forEach((el)=>{observer.observe(el);});window.BENGAL_LAZY_OBSERVER=observer;}
function schedulePreloads(){const scheduleIdle=window.requestIdleCallback||((cb)=>setTimeout(cb,2000));scheduleIdle(()=>{if(document.querySelector('.mermaid')&&!loaded.mermaid){preloadScript('https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js');}
if(document.querySelector('.graph-minimap, .graph-contextual, [data-graph]')&&!loaded.d3){preloadScript('https://d3js.org/d3.v7.min.js');}},{timeout:3000});}
loadTabulator();setupIntersectionObserver();schedulePreloads();window.BENGAL_LAZY_LOADERS={loadMermaid:loadMermaid,loadD3:loadD3,loadTabulator:loadTabulator,loaded:loaded};})();