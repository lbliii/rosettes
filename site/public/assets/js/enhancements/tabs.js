(function(){'use strict';const log=window.BengalUtils?.log||(()=>{});const CLASS_ACTIVE='active';const SELECTOR_TABS='.tabs, .code-tabs';const SELECTOR_NAV_LINK='.tab-nav a';const SELECTOR_NAV_ITEM='.tab-nav li';const SELECTOR_PANE='.tab-pane';const STORAGE_PREFIX='bengal-tabs-sync-';function switchTab(container,activeLink,targetId){const navItems=Array.from(container.querySelectorAll(SELECTOR_NAV_ITEM)).filter(item=>item.closest(SELECTOR_TABS)===container);navItems.forEach(item=>item.classList.remove(CLASS_ACTIVE));const activeItem=activeLink.closest('li');if(activeItem)activeItem.classList.add(CLASS_ACTIVE);const panes=Array.from(container.querySelectorAll(SELECTOR_PANE)).filter(pane=>pane.closest(SELECTOR_TABS)===container);panes.forEach(pane=>pane.classList.remove(CLASS_ACTIVE));const targetPane=document.getElementById(targetId);if(targetPane){targetPane.classList.add(CLASS_ACTIVE);activeLink.setAttribute('aria-selected','true');navItems.forEach(item=>{const link=item.querySelector('a');if(link&&link!==activeLink){link.setAttribute('aria-selected','false');}});const event=new CustomEvent('tabSwitched',{detail:{container,link:activeLink,pane:targetPane}});container.dispatchEvent(event);}}
function syncTabs(syncKey,syncValue){if(!syncKey||syncKey==='none')return;const containers=document.querySelectorAll(`[data-sync="${syncKey}"]`);containers.forEach(container=>{const matchingLink=container.querySelector(`[data-sync-value="${syncValue}"]`);if(matchingLink){const targetId=matchingLink.getAttribute('data-tab-target');if(targetId){switchTab(container,matchingLink,targetId);}}});try{localStorage.setItem(`${STORAGE_PREFIX}${syncKey}`,syncValue);log(`[BengalTabs]Synced ${syncKey}=${syncValue}`);}catch(e){log('[BengalTabs] localStorage unavailable, sync not persisted');}}
function restoreSyncPreferences(){const containers=document.querySelectorAll('[data-sync]');const restored=new Set();containers.forEach(container=>{const syncKey=container.dataset.sync;if(!syncKey||syncKey==='none'||restored.has(syncKey))return;try{const saved=localStorage.getItem(`${STORAGE_PREFIX}${syncKey}`);if(saved){const link=container.querySelector(`[data-sync-value="${saved}"]`);if(link){const targetId=link.getAttribute('data-tab-target');if(targetId){syncTabs(syncKey,saved);restored.add(syncKey);log(`[BengalTabs]Restored ${syncKey}=${saved}`);}}}}catch(e){}});}
async function handleCopyClick(button){const targetId=button.getAttribute('data-copy-target');if(!targetId)return;const codeElement=document.getElementById(targetId);if(!codeElement)return;const code=codeElement.textContent||'';try{await navigator.clipboard.writeText(code);button.classList.add('copied');const label=button.querySelector('.copy-label');const originalText=label?label.textContent:'';if(label)label.textContent='Copied!';setTimeout(()=>{button.classList.remove('copied');if(label)label.textContent=originalText;},2000);log('[BengalTabs] Code copied to clipboard');}catch(err){log('[BengalTabs] Copy failed:',err);try{const textarea=document.createElement('textarea');textarea.value=code;textarea.style.position='fixed';textarea.style.opacity='0';document.body.appendChild(textarea);textarea.select();document.execCommand('copy');document.body.removeChild(textarea);button.classList.add('copied');setTimeout(()=>button.classList.remove('copied'),2000);}catch(fallbackErr){log('[BengalTabs] Copy fallback failed:',fallbackErr);}}}
document.addEventListener('click',(e)=>{const copyBtn=e.target.closest('.copy-btn');if(copyBtn){e.preventDefault();handleCopyClick(copyBtn);return;}
const link=e.target.closest(SELECTOR_NAV_LINK);if(!link)return;const container=link.closest(SELECTOR_TABS);if(!container)return;e.preventDefault();const targetId=link.getAttribute('data-tab-target');if(!targetId)return;const syncKey=container.dataset.sync;const syncValue=link.dataset.syncValue;if(syncKey&&syncValue&&syncKey!=='none'){syncTabs(syncKey,syncValue);}else{switchTab(container,link,targetId);}});document.addEventListener('keydown',(e)=>{const link=e.target.closest(SELECTOR_NAV_LINK);if(!link)return;const container=link.closest(SELECTOR_TABS);if(!container)return;const navItems=Array.from(container.querySelectorAll(SELECTOR_NAV_ITEM)).filter(item=>item.closest(SELECTOR_TABS)===container);const currentIndex=navItems.findIndex(item=>item.contains(link));if(currentIndex===-1)return;let newIndex=-1;switch(e.key){case'ArrowLeft':case'ArrowUp':e.preventDefault();newIndex=currentIndex>0?currentIndex-1:navItems.length-1;break;case'ArrowRight':case'ArrowDown':e.preventDefault();newIndex=currentIndex<navItems.length-1?currentIndex+1:0;break;case'Home':e.preventDefault();newIndex=0;break;case'End':e.preventDefault();newIndex=navItems.length-1;break;default:return;}
if(newIndex>=0){const newLink=navItems[newIndex].querySelector('a');if(newLink){newLink.focus();newLink.click();}}});function initTabs(){const containers=document.querySelectorAll(SELECTOR_TABS);containers.forEach(container=>{const navItems=Array.from(container.querySelectorAll(SELECTOR_NAV_ITEM)).filter(item=>item.closest(SELECTOR_TABS)===container);if(navItems.length>0&&!navItems.some(item=>item.classList.contains(CLASS_ACTIVE))){navItems[0].classList.add(CLASS_ACTIVE);const link=navItems[0].querySelector('a');if(link){const targetId=link.getAttribute('data-tab-target');if(targetId){const pane=document.getElementById(targetId);if(pane)pane.classList.add(CLASS_ACTIVE);}}}});}
function init(){initTabs();restoreSyncPreferences();log('[BengalTabs] Initialized with sync support');}
if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}
if(window.Bengal&&window.Bengal.enhance){Bengal.enhance.register('tabs',function(container,options){const navItems=Array.from(container.querySelectorAll(SELECTOR_NAV_ITEM)).filter(item=>item.closest(SELECTOR_TABS)===container||item.closest('[data-bengal="tabs"]')===container);if(navItems.length>0&&!navItems.some(item=>item.classList.contains(CLASS_ACTIVE))){navItems[0].classList.add(CLASS_ACTIVE);const link=navItems[0].querySelector('a');if(link){const targetId=link.getAttribute('data-tab-target');if(targetId){const pane=document.getElementById(targetId);if(pane)pane.classList.add(CLASS_ACTIVE);}}}
const syncKey=container.dataset.sync;if(syncKey&&syncKey!=='none'){try{const saved=localStorage.getItem(`${STORAGE_PREFIX}${syncKey}`);if(saved){const link=container.querySelector(`[data-sync-value="${saved}"]`);if(link){const targetId=link.getAttribute('data-tab-target');if(targetId){switchTab(container,link,targetId);}}}}catch(e){}}},{override:true});}
window.BengalTabs={sync:syncTabs,switch:switchTab,restoreSync:restoreSyncPreferences};})();