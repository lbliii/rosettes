(function(){'use strict';if(!window.BengalUtils){console.error('[Bengal] BengalUtils not loaded - interactive.js requires utils.js');window.BengalUtils={log:()=>{},throttleScroll:(fn)=>{let ticking=false;return function throttled(...args){if(!ticking){window.requestAnimationFrame(()=>{fn.apply(this,args);ticking=false;});ticking=true;}};},debounce:(fn,wait)=>{let timeout;return function debounced(...args){clearTimeout(timeout);timeout=setTimeout(()=>fn.apply(this,args),wait);};},ready:(fn)=>{if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',fn);}else{fn();}}};}
const log=window.BengalUtils?.log||(()=>{});const throttleScroll=window.BengalUtils?.throttleScroll||((fn)=>{let ticking=false;return function throttled(...args){if(!ticking){window.requestAnimationFrame(()=>{fn.apply(this,args);ticking=false;});ticking=true;}};});const debounce=window.BengalUtils?.debounce||((fn,wait)=>{let timeout;return function debounced(...args){clearTimeout(timeout);timeout=setTimeout(()=>fn.apply(this,args),wait);};});const ready=window.BengalUtils?.ready||((fn)=>{if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',fn);}else{fn();}});const cleanupHandlers={scroll:[],resize:[],click:[],keydown:[]};function setupBackToTop(){const button=document.querySelector('.back-to-top');if(!button){log('Back-to-top button not found in template');return;}
let isVisible=false;const toggleVisibility=()=>{const scrolled=window.pageYOffset||document.documentElement.scrollTop;const shouldShow=scrolled>300;if(shouldShow!==isVisible){isVisible=shouldShow;button.classList.toggle('visible',shouldShow);}};const throttledToggle=throttleScroll(toggleVisibility);window.addEventListener('scroll',throttledToggle,{passive:true});cleanupHandlers.scroll.push(()=>{window.removeEventListener('scroll',throttledToggle);});button.addEventListener('click',()=>{window.scrollTo({top:0,behavior:'smooth'});});toggleVisibility();}
function setupReadingProgress(){const progressBar=document.createElement('div');progressBar.className='reading-progress';progressBar.setAttribute('role','progressbar');progressBar.setAttribute('aria-label','Reading progress');progressBar.setAttribute('aria-valuemin','0');progressBar.setAttribute('aria-valuemax','100');const progressFill=document.createElement('div');progressFill.className='reading-progress__fill';progressFill.style.width='100%';progressFill.style.transformOrigin='left';progressBar.appendChild(progressFill);document.body.insertBefore(progressBar,document.body.firstChild);let cachedDocHeight=document.documentElement.scrollHeight;let cachedWinHeight=window.innerHeight;let lastProgress=-1;const updateDimensions=()=>{cachedDocHeight=document.documentElement.scrollHeight;cachedWinHeight=window.innerHeight;};const updateProgress=()=>{const scrollTop=window.pageYOffset||document.documentElement.scrollTop;const scrollableHeight=cachedDocHeight-cachedWinHeight;const progress=scrollableHeight>0?Math.min(100,Math.max(0,(scrollTop/scrollableHeight)*100)):0;const roundedProgress=Math.round(progress);if(roundedProgress!==lastProgress){lastProgress=roundedProgress;progressFill.style.transform=`scaleX(${progress/100})`;progressBar.setAttribute('aria-valuenow',roundedProgress);}};const throttledUpdate=throttleScroll(updateProgress);window.addEventListener('scroll',throttledUpdate,{passive:true});cleanupHandlers.scroll.push(()=>{window.removeEventListener('scroll',throttledUpdate);});const debouncedDimUpdate=debounce(()=>{updateDimensions();updateProgress();},100);window.addEventListener('resize',debouncedDimUpdate,{passive:true});cleanupHandlers.resize.push(()=>{window.removeEventListener('resize',debouncedDimUpdate);});updateProgress();}
function setupSmoothScroll(){}
function setupScrollSpy(){const sections=document.querySelectorAll('h2[id], h3[id]');if(sections.length===0)return;const navLinks=document.querySelectorAll('.docs-nav a');if(navLinks.length===0)return;let currentSection='';let sectionData=[];const updateSectionCache=()=>{sectionData=Array.from(sections).map(section=>({id:section.getAttribute('id'),element:section,offsetTop:section.offsetTop}));};updateSectionCache();const debouncedCacheUpdate=debounce(updateSectionCache,250);window.addEventListener('resize',debouncedCacheUpdate,{passive:true});cleanupHandlers.resize.push(()=>{window.removeEventListener('resize',debouncedCacheUpdate);});const highlightNavigation=()=>{const scrollPosition=window.pageYOffset||document.documentElement.scrollTop;const headerOffset=80;let foundSection='';for(let i=0;i<sectionData.length;i++){if(scrollPosition>=sectionData[i].offsetTop-headerOffset){foundSection=sectionData[i].id;}}
if(foundSection!==currentSection){currentSection=foundSection;navLinks.forEach(link=>{const href=link.getAttribute('href');const shouldBeActive=currentSection&&href===`#${currentSection}`;if(shouldBeActive){link.classList.add('active');}else{link.classList.remove('active');}});}};const throttledHighlight=throttleScroll(highlightNavigation);window.addEventListener('scroll',throttledHighlight,{passive:true});cleanupHandlers.scroll.push(()=>{window.removeEventListener('scroll',throttledHighlight);});highlightNavigation();}
function setupDocsNavigation(){const activeLink=document.querySelector('.docs-nav-link.active, .docs-nav-link[aria-current="page"], '+
'.docs-nav-group-link.active, .docs-nav-group-link[aria-current="page"]');if(!activeLink){log('Documentation navigation initialized (no active link)');return;}
if(activeLink.classList.contains('docs-nav-group-link')){const summary=activeLink.closest('summary.docs-nav-group-summary');if(summary){const details=summary.parentElement;if(details&&details.tagName==='DETAILS'){details.setAttribute('open','');}}}
let parent=activeLink.parentElement;while(parent){if(parent.tagName==='DETAILS'&&parent.classList.contains('docs-nav-group')){parent.setAttribute('open','');}
parent=parent.parentElement;}
log('Documentation navigation initialized');}
function setupMobileSidebar(){const toggleButton=document.querySelector('.docs-sidebar-toggle');const sidebar=document.getElementById('docs-sidebar');if(!toggleButton||!sidebar)return;toggleButton.addEventListener('click',()=>{const isOpen=sidebar.hasAttribute('data-open');if(isOpen){sidebar.removeAttribute('data-open');toggleButton.setAttribute('aria-expanded','false');document.body.style.overflow='';}else{sidebar.setAttribute('data-open','');toggleButton.setAttribute('aria-expanded','true');document.body.style.overflow='hidden';}});const outsideClickHandler=(e)=>{if(sidebar.hasAttribute('data-open')&&!sidebar.contains(e.target)&&!toggleButton.contains(e.target)){sidebar.removeAttribute('data-open');toggleButton.setAttribute('aria-expanded','false');document.body.style.overflow='';}};document.addEventListener('click',outsideClickHandler);cleanupHandlers.click.push(()=>{document.removeEventListener('click',outsideClickHandler);});sidebar.addEventListener('click',(e)=>{const link=e.target.closest('a');if(link&&window.innerWidth<768){sidebar.removeAttribute('data-open');toggleButton.setAttribute('aria-expanded','false');document.body.style.overflow='';}});}
function setupChangelogFilter(){const filterButtons=document.querySelectorAll('.changelog-filter-btn');const timelineItems=document.querySelectorAll('.timeline-item');if(filterButtons.length===0||timelineItems.length===0)return;filterButtons.forEach(function(button){button.addEventListener('click',function(){const filter=this.getAttribute('data-filter');filterButtons.forEach(function(btn){btn.classList.remove('active');btn.setAttribute('aria-pressed','false');});this.classList.add('active');this.setAttribute('aria-pressed','true');timelineItems.forEach(function(item){const changeTypes=item.getAttribute('data-change-types')||'';const hasStructuredData=changeTypes&&changeTypes!=='all';const shouldShow=filter==='all'||!hasStructuredData||changeTypes.includes(filter);if(shouldShow){item.style.display='';item.style.opacity='0';setTimeout(function(){item.style.transition='opacity 0.3s ease';item.style.opacity='1';},10);}else{item.style.display='none';}});});});}
function init(){cleanup();const prefersReducedMotion=window.matchMedia('(prefers-reduced-motion: reduce)').matches;if(prefersReducedMotion){document.documentElement.classList.add('reduce-motion');}
setupBackToTop();setupReadingProgress();setupSmoothScroll();setupScrollSpy();setupDocsNavigation();setupMobileSidebar();setupChangelogFilter();log('Interactive elements initialized');}
function cleanup(){cleanupHandlers.scroll.forEach(handler=>handler());cleanupHandlers.resize.forEach(handler=>handler());cleanupHandlers.click.forEach(handler=>handler());cleanupHandlers.keydown.forEach(handler=>handler());cleanupHandlers.scroll=[];cleanupHandlers.resize=[];cleanupHandlers.click=[];cleanupHandlers.keydown=[];}
if(window.Bengal&&window.Bengal.enhance){Bengal.enhance.register('back-to-top',function(el,options){setupBackToTop();});Bengal.enhance.register('reading-progress',function(el,options){setupReadingProgress();});Bengal.enhance.register('docs-nav',function(el,options){setupScrollSpy();});}
ready(init);window.addEventListener('beforeunload',cleanup);window.BengalInteractive={cleanup:cleanup};})();